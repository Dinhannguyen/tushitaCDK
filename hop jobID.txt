-- [[ SCRIPT 2: CHECK FILE & HOP SERVER (CH·ªà D√ÄNH CHO baohan_200) ]] --

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local player = Players.LocalPlayer

-- Ki·ªÉm tra ƒë√∫ng username
if player.Name ~= "baohan_200" then
    warn("‚õî Script n√†y ch·ªâ ch·∫°y tr√™n t√†i kho·∫£n: baohan_200")
    return -- D·ª´ng script ngay l·∫≠p t·ª©c n·∫øu sai t√™n
end

local folderName = "mm"
local checkInterval = 3 -- Check file m·ªói 3 gi√¢y

print("‚úÖ ƒê√£ k√≠ch ho·∫°t ch·∫ø ƒë·ªô sƒÉn God's Chalice cho baohan_200")

spawn(function()
    while true do
        wait(checkInterval)
        
        pcall(function()
            if not isfolder(folderName) then return end
            
            local files = listfiles(folderName)
            local validServers = {}
            local currentTime = os.time()

            -- 1. ƒê·ªçc v√† l·ªçc c√°c file h·ª£p l·ªá
            for _, file in ipairs(files) do
                if file:sub(-4) == ".txt" then -- Ch·ªâ ƒë·ªçc file .txt
                    local success, content = pcall(readfile, file)
                    if success then
                        local data = HttpService:JSONDecode(content)
                        
                        -- Logic: Th·ªùi gian hi·ªán t·∫°i - Th·ªùi gian file < 300 gi√¢y (5 ph√∫t)
                        if data.TimeCheck and (currentTime - data.TimeCheck) < 300 then
                            table.insert(validServers, data)
                        else
                            -- (T√πy ch·ªçn) X√≥a file r√°c qu√° 5 ph√∫t ƒë·ªÉ d·ªçn d·∫πp
                            -- delfile(file) 
                        end
                    end
                end
            end

            -- 2. S·∫Øp x·∫øp ∆∞u ti√™n: File n√†o M·ªöI H∆†N (TimeCheck l·ªõn h∆°n) th√¨ ƒë·ª©ng ƒë·∫ßu
            table.sort(validServers, function(a, b)
                return a.TimeCheck > b.TimeCheck
            end)

            -- 3. Th·ª±c hi·ªán Hop Server
            if #validServers > 0 then
                local target = validServers[1] -- L·∫•y file ∆∞u ti√™n nh·∫•t
                
                -- Ch·ªâ hop n·∫øu JobID kh√°c server hi·ªán t·∫°i
                if game.JobId ~= target.JobID then
                    print("üöÄ T√¨m th·∫•y God's Chalice t·ª´: " .. target.Username)
                    print("üïí Th·ªùi gian: " .. target.DateString)
                    print("‚úàÔ∏è ƒêang hop qua server...")
                    
                    TeleportService:TeleportToPlaceInstance(target.PlaceID, target.JobID, player)
                else
                    print("‚úÖ ƒêang ·ªü trong server c√≥ God's Chalice c·ªßa: " .. target.Username)
                end
            else
                print("üí§ Kh√¥ng t√¨m th·∫•y file h·ª£p l·ªá (ho·∫∑c qu√° h·∫°n 5p)...")
            end
        end)
    end
end)